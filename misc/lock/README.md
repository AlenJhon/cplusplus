# 锁

#### 从上到下锁从轻到重

#### 偏向锁 
- 标记 把自己的线程ID写入 标记我在使用这个锁
- 当有竞争的时候升级成自旋锁
- 现实情况中大多数70%是一个线程在用

#### 自旋锁(cas)用户空间
- 如果自旋的数量超过核数的一半需要进入重量级锁
- 等待的时间太久,反倒会更多的CPU会空耗
- cas  比较修改，写入时发现不一样，继续读出，再写入，一直循环直到能写入为止
cas 机制并没有保证 smp的安全， 通过CPU提供的lock指令支持

#### 重量级 借用系统实现